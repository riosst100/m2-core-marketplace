<?php
$couponCollection = $block->getCollection();
$data = $couponCollection->getData();
$coupon_helper = $this->helper("Lofmp\CouponCode\Helper\Data");
?>
<div class="helper-text"><?= $coupon_helper->getCouponHelperText(); ?></div>
<div class="coupon-filter-block">
    <span class="filter-label"><?= $block->escapeHtml("Filter ");?></span>
    <ul class="filter-tab">
        <li class="tab-item <?= $block->getActiveClass("all"); ?>"><a href="<?= $block->getUrl("couponcode/customer/index/filter/all"); ?>"><?= $block->escapeHtml(__("All"));?></a></li>
        <li class="tab-item <?= $block->getActiveClass("available"); ?>"><a href="<?= $block->getUrl("couponcode/customer/index/filter/available"); ?>"><?= $block->escapeHtml(__("Available"));?></a></li>
        <li class="tab-item <?= $block->getActiveClass("used"); ?>"><a href="<?= $block->getUrl("couponcode/customer/index/filter/used"); ?>"><?= $block->escapeHtml(__("Used"));?></a></li>
        <li class="tab-item <?= $block->getActiveClass("expired"); ?>"><a href="<?= $block->getUrl("couponcode/customer/index/filter/expired"); ?>"><?= $block->escapeHtml(__("Expired"));?></a></li>
    </ul>
</div>
<?php if (count($data) > 0): ?>
<div class="table-wrapper orders-history">
        <table class="data table table-order-items history" id="my-orders-table">
            <caption class="table-caption"><?= __('Grid Record') ?></caption>
            <thead>
                <tr>
                    <th scope="col" class="col id"><?= __('#') ?></th>
                    <th scope="col" class="col title"><?= __('Code') ?></th>
                    <th scope="col" class="col date"><?= __('Email') ?></th>
                    <th scope="col" class="col date"><?= __('Discount Amount') ?></th>
                    <th scope="col" class="col date"><?= __('Generated By') ?></th>
                    <th scope="col" class="col date"><?= __('Expire At') ?></th>
                </tr>
            </thead>
            <tbody>
                <?php
                $no = 1;
                foreach ($data as $val):
                    $rule_data = $couponCollection->getRule($val["rule_id"]);
                    $seller_name = "";
                    $seller_url = "";
                    if(isset($val['seller_id']) && $val['seller_id']){
                        $seller = $this->getSellerById($val['seller_id']);
                        if($seller){
                            $seller_name = $seller->getName();
                            $seller_url = $seller->getUrl();
                        }
                    }
                    $expired_date = isset($val['expiration_date']) && $val['expiration_date'] ? $val['expiration_date'] : $rule_data["to_date"];
                ?>
                    <tr>
                        <td class="col id"><?= $no ?></td>
                        <td class="col shipping"><?= $val["code"] ?></td>
                        <td class="col email"><?= $val["email"] ?></td>
                        <td class="col discount-amount"><?= $coupon_helper->discountAmountFormat($rule_data["rule_id"], $rule_data["discount_amount"]);?></td>
                        <td class="col author">
                        <?php if($seller_name): ?>
                        <a href="<?= $seller_url; ?>" target="_blank" title="<?= __("View Seller");?>"><?= $seller_name; ?></a>
                        <?php else:
                            echo __("Admin");
                        endif;
                        ?>
                        </td>
                        <td class="col expire"><?= $block->formatDate($expired_date, \IntlDateFormatter::LONG);?></td>
                    </tr>
                <?php $no++; endforeach; ?>
            </tbody>
        </table>
    </div>
    <?php if ($block->getPagerHtml()): ?>
    <div class="order-products-toolbar toolbar bottom"><?= $block->getPagerHtml();?></div>
    <?php endif ?>
<?php else: ?>
    <div class="message info empty"><span><?= __('There are no coupon codes available.'); ?></span></div>
<?php endif ?>
